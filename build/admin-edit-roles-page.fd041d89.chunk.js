"use strict";(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[2544],{33778:function(V,v,a){a.r(v),a.d(v,{default:function(){return D}});var e=a(32735),n=a(13478),y=a(5141),S=a(72041),t=a(39161),C=a(83281),T=a(57269),x=a(33795),b=a.n(x),R=a(5636),A=a(78974),I=a(60216),c=a.n(I);const E=({disabled:l,role:s,values:i,errors:r,onChange:p,onBlur:m})=>{const{formatMessage:o}=(0,R.useIntl)();return e.createElement(t.Box,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(t.Stack,{spacing:4},e.createElement(t.Flex,{justifyContent:"space-between"},e.createElement(t.Box,null,e.createElement(t.Box,null,e.createElement(t.Typography,{fontWeight:"bold"},s?s.name:o({id:"global.details",defaultMessage:"Details"}))),e.createElement(t.Box,null,e.createElement(t.Typography,{textColor:"neutral500",variant:"pi"},s?s.description:o({id:"Settings.roles.form.description",defaultMessage:"Name and description of the role"})))),e.createElement(t.Button,{disabled:!0,variant:"secondary"},o({id:"Settings.roles.form.button.users-with-role",defaultMessage:"{number, plural, =0 {# users} one {# user} other {# users}} with this role"},{number:s.usersCount}))),e.createElement(t.Grid,{gap:4},e.createElement(t.GridItem,{col:6},e.createElement(t.TextInput,{disabled:l,name:"name",error:r.name&&o({id:r.name}),label:o({id:"global.name",defaultMessage:"Name"}),onChange:p,onBlur:m,value:i.name||""})),e.createElement(t.GridItem,{col:6},e.createElement(t.Textarea,{disabled:l,label:o({id:"global.description",defaultMessage:"Description"}),name:"description",error:r.name&&o({id:r.name}),onChange:p,onBlur:m},i.description||"")))))};E.defaultProps={disabled:!1,role:null,values:{name:"",description:""}},E.propTypes={disabled:c().bool,errors:c().object.isRequired,onBlur:c().func.isRequired,onChange:c().func.isRequired,role:c().object,values:c().object};var U=E,P=a(8888),L=a(5173),F=L.Ry().shape({name:L.Z_().required(n.translatedErrors.required)}),k=()=>{const l=(0,n.useNotification)(),{formatMessage:s}=(0,R.useIntl)(),{params:{id:i}}=(0,y.useRouteMatch)("/settings/roles/:id"),[r,p]=(0,e.useState)(!1),m=(0,e.useRef)(),{lockApp:o,unlockApp:j}=(0,n.useOverlayBlocker)(),{trackUsage:N}=(0,n.useTracking)(),{isLoading:Z,data:z}=(0,P.U_)(i),{role:u,permissions:G,isLoading:M,onSubmitSucceeded:O}=(0,P.Dq)(i),$=async g=>{try{o(),p(!0);const{permissionsToSend:d,didUpdateConditions:f}=m.current.getPermissions();await(0,n.request)(`/admin/roles/${i}`,{method:"PUT",body:g}),u.code!=="strapi-super-admin"&&(await(0,n.request)(`/admin/roles/${i}/permissions`,{method:"PUT",body:{permissions:d}}),f&&N("didUpdateConditions")),m.current.setFormAfterSubmit(),O({name:g.name,description:g.description}),l({type:"success",message:{id:"notification.success.saved"}})}catch(d){console.error(d.response);const f=b()(d,"response.payload.message","An error occured"),h=b()(d,"response.payload.data.permissions[0]",f);l({type:"warning",message:h})}finally{p(!1),j()}},B=u.code==="strapi-super-admin";return e.createElement(t.Main,null,e.createElement(n.SettingsPageTitle,{name:"Roles"}),e.createElement(C.Formik,{enableReinitialize:!0,initialValues:{name:u.name,description:u.description},onSubmit:$,validationSchema:F,validateOnChange:!1},({handleSubmit:g,values:d,errors:f,handleChange:h,handleBlur:H})=>e.createElement("form",{onSubmit:g},e.createElement(t.HeaderLayout,{primaryAction:e.createElement(t.Stack,{horizontal:!0,spacing:2},e.createElement(t.Button,{disabled:u.code==="strapi-super-admin",onClick:g,loading:r,size:"L"},s({id:"global.save",defaultMessage:"Save"}))),title:s({id:"Settings.roles.edit.title",defaultMessage:"Edit a role"}),subtitle:s({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"}),navigationAction:e.createElement(n.Link,{startIcon:e.createElement(T.ArrowLeft,null),to:"/settings/roles"},s({id:"global.back",defaultMessage:"Back"}))}),e.createElement(t.ContentLayout,null,e.createElement(t.Stack,{spacing:6},e.createElement(U,{isLoading:M,disabled:B,errors:f,values:d,onChange:h,onBlur:H,role:u}),!Z&&!M?e.createElement(t.Box,{shadow:"filterShadow",hasRadius:!0},e.createElement(A.Z,{isFormDisabled:B,permissions:G,ref:m,layout:z})):e.createElement(t.Box,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(n.LoadingIndicatorPage,null)))))))},D=()=>{const l=(0,e.useMemo)(()=>({read:S.Z.settings.roles.read,update:S.Z.settings.roles.update}),[]),{isLoading:s,allowedActions:{canRead:i,canUpdate:r}}=(0,n.useRBAC)(l);return s?e.createElement(n.LoadingIndicatorPage,null):!i&&!r?e.createElement(y.Redirect,{to:"/"}):e.createElement(k,null)}}}]);
